{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>{{ profile.user.username }} - TopBlogs</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">

  <style>
    body { background-color: #f8f9fa; font-family: "Poppins", sans-serif; }

    /* Navbar */
    header {
      background: linear-gradient(90deg, #007bff, #00bcd4);
      color: white;
      padding: 1rem 2rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    header h1 { font-size: 1.8rem; margin: 0; font-weight: 600; display: flex; align-items: center; gap: 0.5rem; }
    .nav-btn {
      background-color: white;
      color: #007bff;
      padding: 0.5rem 1.2rem;
      border-radius: 6px;
      font-weight: 600;
      text-decoration: none;
      transition: all 0.3s ease;
      margin-left: 10px;
    }
    .nav-btn:hover { background-color: #0056b3; color: white; }

    .content-wrapper {
      min-height: 80vh;
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      padding: 40px;
      gap: 30px;
    }

    .main-content { flex: 3; }

    .post-card {
      border: none;
      border-radius: 10px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.05);
      margin-bottom: 20px;
      padding: 20px;
      background-color: white;
    }

    .sidebar {
      flex: 1;
      background-color: white;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
    }
    .sidebar h5 { font-weight: 600; color: #007bff; margin-bottom: 20px; text-align: center; }
    .user-item { display: flex; align-items: center; justify-content: space-between; padding: 10px 0; border-bottom: 1px solid #f1f1f1; }
    .user-info { display: flex; align-items: center; gap: 10px; }
    .user-info img { width: 45px; height: 45px; border-radius: 50%; object-fit: cover; border: 2px solid #007bff; }
    .user-info span { font-weight: 500; color: #333; cursor: pointer; }

    /* Buttons & links */
    .see-more { cursor: pointer; color: #0d6efd; font-size: 0.85rem; margin-left: 5px; }

    footer { background-color: #007bff; color: white; padding: 0.8rem 0; text-align: center; margin-top: 30px; }
  </style>
</head>

<body>

<!-- Header / Navbar -->
<header>
  <h1><i class="bi bi-journal-text"></i> <span style="color: #ffe600;">TopBlogs</span></h1>
  <div>
    <a href="{% url 'home' %}" class="nav-btn">Home</a>
    <a href="{% url 'profile' %}" class="nav-btn">Profile</a>
    {% if user.is_authenticated %}
      <a href="{% url 'logout' %}" class="nav-btn">Logout</a>
    {% else %}
      <a href="{% url 'login' %}" class="nav-btn">Login</a>
    {% endif %}
  </div>
</header>

<!-- Main Content -->
<div class="content-wrapper container">

  <!-- Center: Posts Feed -->
  <div class="main-content">
    <h3 class="text-primary fw-bold mb-4">{{ profile.user.username }}'s Posts</h3>

    {% if posts %}
      {% for post in posts %}
        <div class="post-card row g-3 align-items-start">
          <div class="col-md-4">
            {% if post.image %}
              <img src="{{ post.image.url }}" class="img-fluid rounded" style="width:100%; max-height:250px; object-fit:cover;">
            {% else %}
              <img src="{% static 'default.png' %}" class="img-fluid rounded" style="width:100%; max-height:250px; object-fit:cover;">
            {% endif %}
          </div>
          <div class="col-md-8">
            <div class="d-flex align-items-center mb-2">
              {% if post.author.profile.image %}
                <img src="{{ post.author.profile.image.url }}" alt="{{ post.author.username }}" class="rounded-circle me-2" width="50" height="50">
              {% else %}
                <img src="{% static 'default.png' %}" alt="Default" class="rounded-circle me-2" width="50" height="50">
              {% endif %}
              <div>
                <strong>{{ post.author.username }}</strong><br>
                <small class="text-muted">{{ post.created_at|date:"M d, Y H:i" }}</small>
              </div>
            </div>

            <h5 class="fw-bold post-title">{{ post.title|truncatechars:50 }}</h5>
            <p class="post-text">{{ post.text|truncatechars:120 }}</p>

          </div>
        </div>
      {% endfor %}
    {% else %}
      <p class="text-muted text-center">No posts yet.</p>
    {% endif %}
  </div>

  <!-- Sidebar: Followers & Following -->
  <div class="sidebar">
    <h5>Followers</h5>
    <div id="followers-list">
      {% for f in followers %}
        <div class="user-item">
          <div class="user-info">
            {% if f.follower.profile.image %}
              <img src="{{ f.follower.profile.image.url }}" alt="{{ f.follower.username }}">
            {% else %}
              <img src="{% static 'default.png' %}" alt="Default">
            {% endif %}
            <span>{{ f.follower.username }}</span>
          </div>
        </div>
      {% endfor %}
    </div>
    {% if followers|length > 2 %}
      <div class="text-center mt-2">
        <span id="toggle-followers" class="see-more">See All</span>
      </div>
    {% endif %}

    <h5 class="mt-4">Following</h5>
    <div id="following-list">
      {% for f in following %}
        <div class="user-item">
          <div class="user-info">
            {% if f.following.profile.image %}
              <img src="{{ f.following.profile.image.url }}" alt="{{ f.following.username }}">
            {% else %}
              <img src="{% static 'default.png' %}" alt="Default">
            {% endif %}
            <span>{{ f.following.username }}</span>
          </div>
        </div>
      {% endfor %}
    </div>
    {% if following|length > 2 %}
      <div class="text-center mt-2">
        <span id="toggle-following" class="see-more">See All</span>
      </div>
    {% endif %}
  </div>

</div>

<footer>
  <p>&copy; 2025 TopBlogs â€” All rights reserved.</p>
</footer>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
document.addEventListener("DOMContentLoaded", function() {
  // Toggle Followers
  const followersList = document.getElementById("followers-list");
  const toggleFollowers = document.getElementById("toggle-followers");
  if(toggleFollowers){
    let showAllFollowers = false;
    const followerItems = followersList.children;
    const initialFollowerCount = 2;
    for(let i = initialFollowerCount; i < followerItems.length; i++){
      followerItems[i].style.display = "none";
    }
    toggleFollowers.addEventListener("click", function() {
      showAllFollowers = !showAllFollowers;
      for(let i = initialFollowerCount; i < followerItems.length; i++){
        followerItems[i].style.display = showAllFollowers ? "flex" : "none";
      }
      this.textContent = showAllFollowers ? "See Less" : "See All";
    });
  }

  // Toggle Following
  const followingList = document.getElementById("following-list");
  const toggleFollowing = document.getElementById("toggle-following");
  if(toggleFollowing){
    let showAllFollowing = false;
    const followingItems = followingList.children;
    const initialFollowingCount = 2;
    for(let i = initialFollowingCount; i < followingItems.length; i++){
      followingItems[i].style.display = "none";
    }
    toggleFollowing.addEventListener("click", function() {
      showAllFollowing = !showAllFollowing;
      for(let i = initialFollowingCount; i < followingItems.length; i++){
        followingItems[i].style.display = showAllFollowing ? "flex" : "none";
      }
      this.textContent = showAllFollowing ? "See Less" : "See All";
    });
  }
});
</script>
</body>
</html>
